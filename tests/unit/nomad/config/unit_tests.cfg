[core]
# The executor class that airflow should use. Choices include
# ``LocalExecutor``, ``CeleryExecutor``,
# ``KubernetesExecutor`` or the full import path to the class when using a custom executor.
#
# Variable: AIRFLOW__CORE__EXECUTOR
#
# executor = LocalExecutor
#
executor = airflow.providers.nomad.executors.nomad_executor.NomadExecutor

[logging]
# Name of handler to read task instance logs.
# Defaults to use ``task`` handler.
#
# Variable: AIRFLOW__LOGGING__TASK_LOG_READER
#
#
# [NOMAD]: Mandatory so that the API server can read logs from the Nomad cluster
task_log_reader = nomad_log_handler


# Logging class
# Specify the class that will specify the logging configuration
# This class has to be on the python classpath
#
# Example: logging_config_class = my.path.default_local_settings.LOGGING_CONFIG
#
# Variable: AIRFLOW__LOGGING__LOGGING_CONFIG_CLASS
#
logging_config_class = airflow.providers.nomad.log.NOMAD_LOG_CONFIG

[nomad_provider]
# Generic Airflow executor parallelism (should be higher than 0)
#
# Example: parallelism = 128
#
# Variable: AIRFLOW__NOMAD_PROVIDER__PARALLELISM
#
parallelism = 128

# Nomad server
#
# Example: agent_host = 192.168.122.226
#
# Variable: AIRFLOW__NOMAD_PROVIDER__AGENT_HOST
#
# agent_host =
agent_host = 127.0.0.1

# Whether TLS certificates are to be considered
#
# Variable: AIRFLOW__NOMAD_PROVIDER__AGENT_SECURE
#
agent_secure = False

# Absolute path to client certificate
#
# Example: agent_cert_path = /absolute/path/to/certs/global-cli-nomad.pem
#
# Variable: AIRFLOW__NOMAD_PROVIDER__AGENT_CERT_PATH
#
agent_cert_path =

# Absolute path to client key
#
# Example: agent_key_path = /absolute/path/to/certs/global-cli-nomad-key.pem
#
# Variable: AIRFLOW__NOMAD_PROVIDER__AGENT_KEY_PATH
#
agent_key_path =

# Absolute paht to CA certificate or true/false
#
# Example: agent_verify = /absolute/path/to/certs/nomad-agent-ca.pem
#
# Variable: AIRFLOW__NOMAD_PROVIDER__AGENT_VERIFY
#
agent_verify =

# Specific .hcl or .json template to use for job submission, instead of in-built defaults
#
# Example: default_job_template = /absolute/path/to/job_template.{json,hcl}
#
# Variable: AIRFLOW__NOMAD_PROVIDER__DEFAULT_JOB_TEMPLATE
#
default_job_template =

# Default Docker image for the default job template
#
# Example: default_docker_image = python:latest
#
# Variable: AIRFLOW__NOMAD_PROVIDER__DEFAULT_DOCKER_IMAGE
#
default_docker_image = novakjudit/af_nomad_test:0.0.2

# Timeout in seconds before failed allocations may be considered as failed jobs
#
# Example: alloc_pending_timeout = 600
#
# Variable: AIRFLOW__NOMAD_PROVIDER__ALLOC_PENDING_TIMEOUT
#
alloc_pending_timeout = 600

# Time delay for Nomad Opeators supervision cycle, to check on child Nomad job
#
# Example: operator_poll_delay = 5
#
# Variable: AIRFLOW__NOMAD_PROVIDER__OPERATOR_POLL_DELAY
#
operator_poll_delay = 10
